name: Add issues to Ignite Project

on:
  issues:
    types: [opened]

jobs:
  add-to-project:
    name: Add issue to project
    runs-on: ubuntu-latest
    permissions:
      issues: write
      repository-projects: write
    steps:
      - name: Add issue to project
        uses: actions/add-to-project@v1.0.2
        with:
          project-url: https://github.com/orgs/microsoft/projects/1337
          github-token: ${{ secrets.ADD_TO_PROJECT_PAT }}

  label_issues:
    name: Label new issues
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Label issue
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const title = issue.title.toLowerCase();
            const body = (issue.body || '').toLowerCase();
            
            let labels = ['triage'];
            
            // Add labels based on issue content
            if (title.includes('bug') || body.includes('bug') || title.includes('error') || body.includes('error')) {
              labels.push('bug');
            }
            
            if (title.includes('feature') || body.includes('feature') || title.includes('enhancement')) {
              labels.push('enhancement');
            }
            
            if (title.includes('documentation') || body.includes('documentation') || title.includes('docs')) {
              labels.push('documentation');
            }
            
            if (title.includes('question') || body.includes('question') || title.includes('help')) {
              labels.push('question');
            }
            
            // Add technology-specific labels
            if (title.includes('azure') || body.includes('azure')) {
              labels.push('azure');
            }
            
            if (title.includes('function') || body.includes('function') || title.includes('azure functions')) {
              labels.push('azure-functions');
            }
            
            if (title.includes('mcp') || body.includes('mcp') || title.includes('model context protocol')) {
              labels.push('mcp');
            }
            
            if (title.includes('ai') || body.includes('ai') || title.includes('artificial intelligence')) {
              labels.push('ai');
            }
            
            // Apply the labels
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              labels: labels
            });
            
            console.log(`Applied labels: ${labels.join(', ')}`);